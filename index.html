<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HS / CA Code Lookup</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>window.BRAND = { primary: "#00846C" };</script>

  <style>
    :root { color-scheme: light dark; }
    body { font-family: Aptos, "Aptos Display", "Segoe UI", system-ui, -apple-system, Arial, sans-serif; }
    .brand-bg { background-color: var(--brand); }
    .brand-ring { box-shadow: 0 0 0 3px color-mix(in srgb, var(--brand) 22%, transparent); }
    .thead-tint { background-color: color-mix(in srgb, var(--brand) 16%, white); }
    @media (prefers-color-scheme: dark) {
      .thead-tint { background-color: color-mix(in srgb, var(--brand) 18%, #0b1220); }
    }
    mark { padding: 0 2px; border-radius: 4px; background: color-mix(in srgb, var(--brand) 22%, transparent); }
    .tap { min-height: 44px; }
  </style>
</head>

<body class="min-h-screen bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-50">
<script>document.documentElement.style.setProperty("--brand", window.BRAND.primary);</script>

<header class="border-b border-slate-200 bg-white/80 backdrop-blur dark:border-slate-800 dark:bg-slate-950/80">
  <div class="mx-auto max-w-7xl px-4 py-5">
    <div class="flex items-center gap-4">
      <img src="./logo.png" alt="Company logo"
        class="h-14 w-auto rounded-xl bg-white p-2 shadow-sm ring-1 ring-slate-200 dark:bg-slate-900 dark:ring-slate-800" />
      <div class="min-w-0">
        <h1 class="text-lg font-semibold leading-tight sm:text-2xl sm:tracking-tight">
          Look Up Your Product's HS Code and Singapore CA Code Here
        </h1>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
          Search by HS Code, CA Product Code, or description.
        </p>
      </div>
      <span id="statusChip" class="ml-auto hidden rounded-full px-3 py-1 text-xs font-medium text-white brand-bg">Ready</span>
    </div>
  </div>
</header>

<div class="sticky top-0 z-30 border-b border-slate-200 bg-slate-50/90 backdrop-blur dark:border-slate-800 dark:bg-slate-950/90">
  <div class="mx-auto max-w-7xl px-4 py-3">
    <label class="block text-xs font-medium text-slate-600 dark:text-slate-300">Search</label>

    <div class="mt-1">
      <div class="flex items-center gap-2 rounded-2xl border border-slate-200 bg-white px-4 py-3 shadow-sm
                  focus-within:border-transparent focus-within:brand-ring
                  dark:border-slate-800 dark:bg-slate-900">
        <input id="q" type="text"
          class="w-full bg-transparent text-base outline-none placeholder:text-slate-400 sm:text-sm"
          placeholder="HS (01012100), CA (VBA0HO), or keywords"
          autocomplete="off" inputmode="search" />
        <button id="clearBtn"
          class="tap rounded-xl border border-slate-200 bg-white px-3 text-sm font-medium shadow-sm hover:bg-slate-50
                 focus:outline-none brand-ring
                 dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800">
          Clear
        </button>
      </div>
    </div>

    <div class="mt-2 flex items-center justify-between">
      <p class="text-xs text-slate-500 dark:text-slate-400">
        Partial words work. Any word can match.
      </p>
      <span id="countPill"
        class="rounded-full px-2.5 py-1 text-xs font-medium text-slate-800 dark:text-slate-100"
        style="background-color: color-mix(in srgb, #00846C 14%, white);">
        0
      </span>
    </div>

    <div id="loadMsg" class="mt-2 text-xs text-slate-500 dark:text-slate-400">Loading dataâ€¦</div>
  </div>
</div>

<main class="mx-auto max-w-7xl px-4 py-5">
  <section class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-800 dark:bg-slate-900">
    <div class="overflow-auto">
      <table class="min-w-full text-left text-sm">
        <thead class="thead-tint text-xs uppercase tracking-wide text-slate-800 dark:text-slate-100">
          <tr>
            <th class="px-4 py-3">HS Code</th>
            <th class="px-4 py-3">HS Description</th>
            <th class="px-4 py-3">CA Product Code</th>
            <th class="px-4 py-3 hidden md:table-cell">CA Product Description</th>
          </tr>
        </thead>
        <tbody id="rows" class="divide-y divide-slate-200 dark:divide-slate-800"></tbody>
      </table>
    </div>

    <div id="emptyState" class="hidden px-6 py-10 text-center">
      <div class="mx-auto max-w-md">
        <div class="text-base font-semibold">No matching records</div>
        <div class="mt-2 text-sm text-slate-600 dark:text-slate-300">
          Try fewer keywords or a shorter prefix.
        </div>
      </div>
    </div>

    <div id="moreWrap" class="hidden border-t border-slate-200 px-4 py-3 dark:border-slate-800">
      <button id="moreBtn"
        class="tap w-full rounded-xl border border-slate-200 bg-white px-3 py-3 text-sm font-medium shadow-sm hover:bg-slate-50
               focus:outline-none brand-ring
               dark:border-slate-800 dark:bg-slate-900 dark:hover:bg-slate-800">
        Show more
      </button>
      <div id="moreHint" class="mt-2 text-center text-xs text-slate-500 dark:text-slate-400"></div>
    </div>
  </section>
</main>

<script>
  const qEl = document.getElementById("q");
  const rowsEl = document.getElementById("rows");
  const emptyState = document.getElementById("emptyState");
  const clearBtn = document.getElementById("clearBtn");
  const statusChip = document.getElementById("statusChip");
  const loadMsg = document.getElementById("loadMsg");
  const countPill = document.getElementById("countPill");
  const moreWrap = document.getElementById("moreWrap");
  const moreBtn = document.getElementById("moreBtn");
  const moreHint = document.getElementById("moreHint");

  let raw = [];
  let searchText = [];     // precomputed lowercase strings
  let filteredIdx = [];    // indices into raw
  let shown = 0;

  const PAGE_SIZE = 150;
  const INPUT_DEBOUNCE_MS = 220;

  const clean = (v) => String(v ?? "").trim();
  const escHtml = (s) => String(s ?? "")
      .replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;").replaceAll("'", "&#39;");

  function pick(r, keys) {
    for (const k of keys) {
      if (r && r[k] !== undefined && r[k] !== null && String(r[k]).trim() !== "") return String(r[k]);
    }
    return "";
  }

  function tokenize(q) {
    return q.toLowerCase().trim().split(/\s+/).filter(Boolean);
  }

  function setCount(n) { countPill.textContent = String(n); }

  function debounce(fn, ms) {
    let t = null;
    return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
  }

  function resetTable() {
    rowsEl.innerHTML = "";
    shown = 0;
  }

  function renderPage() {
    const end = Math.min(shown + PAGE_SIZE, filteredIdx.length);
    const frag = document.createDocumentFragment();

    for (let p = shown; p < end; p++) {
      const idx = filteredIdx[p];
      const r = raw[idx];

      const hs = pick(r, ["hs", "hs_code", "HS Code"]);
      const hsDesc = pick(r, ["hs_desc", "HS Description", "description", "Description"]);
      const caCode = pick(r,
